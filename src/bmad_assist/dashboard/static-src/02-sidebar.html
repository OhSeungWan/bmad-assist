        <aside class="bg-sidebar border-r border-sidebar-border flex flex-col relative flex-shrink-0"
               x-data="{ sidebarWidth: 256 }"
               :style="`width: ${sidebarWidth}px`">
            <!-- Header -->
            <header class="p-4 border-b border-sidebar-border">
                <h1 class="text-lg font-bold text-sidebar-primary flex items-center gap-2">
                    <a href="#" @click.prevent="resetDashboard()" class="flex items-center gap-2 group cursor-pointer">
                        <!-- Logo: outline by default, filled + outline on hover -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                             class="transition-all duration-200">
                            <!-- Blue - Plan -->
                            <rect width="7" height="9" x="3" y="3" rx="1.5" stroke="currentColor" stroke-width="1.5"
                                  class="fill-transparent stroke-sidebar-primary transition-all group-hover:fill-[#58a6ff] group-hover:stroke-[#58a6ff]"/>
                            <!-- Orange - Validate -->
                            <rect width="7" height="5" x="14" y="3" rx="1.5" stroke="currentColor" stroke-width="1.5"
                                  class="fill-transparent stroke-sidebar-primary transition-all group-hover:fill-[#d29922] group-hover:stroke-[#d29922]"/>
                            <!-- Green - Develop -->
                            <rect width="7" height="9" x="14" y="12" rx="1.5" stroke="currentColor" stroke-width="1.5"
                                  class="fill-transparent stroke-sidebar-primary transition-all group-hover:fill-[#3fb950] group-hover:stroke-[#3fb950]"/>
                            <!-- Red - Review -->
                            <rect width="7" height="5" x="3" y="16" rx="1.5" stroke="currentColor" stroke-width="1.5"
                                  class="fill-transparent stroke-sidebar-primary transition-all group-hover:fill-[#f85149] group-hover:stroke-[#f85149]"/>
                        </svg>
                        <span class="group-hover:text-accent transition-colors">bmad-assist</span>
                    </a>
                    <span class="text-xs font-normal text-muted-foreground/50 ml-auto" x-text="version ? 'v' + version : ''"></span>
                </h1>
                <div class="flex items-center gap-2 mt-2 text-sm">
                    <i :data-lucide="connected ? 'wifi' : 'wifi-off'"
                       :class="connected ? 'text-accent' : 'text-destructive'"
                       class="w-4 h-4"></i>
                    <span x-text="connected ? 'Connected' : 'Disconnected'" class="text-sidebar-foreground"></span>
                </div>
            </header>

            <!-- Tree View - Compact -->
            <nav class="flex-1 overflow-y-auto p-1 pb-4 text-sm" id="tree-view" data-testid="tree-view"
                 @click.self="selectedItem = { type: null, epic: null, story: null, phase: null }">
                <div id="tree-content">
                    <template x-if="stories.epics">
                        <div>
                            <template x-for="epic in stories.epics" :key="epic.id">
                                <div class="group/epic">
                                    <!-- Epic -->
                                    <div class="flex items-center gap-1.5 py-0.5 cursor-pointer hover:bg-white/10 rounded-sm transition-colors"
                                         data-testid="epic-node"
                                         :data-status="epic.status"
                                         :class="{'bg-primary/10 ring-1 ring-primary/50': selectedItem.type === 'epic' && selectedItem.epic?.id === epic.id}"
                                         @click="selectItem('epic', epic); toggleEpic(epic.id)"
                                         @contextmenu.prevent="showContextMenu($event, 'epic', epic)">
                                        <i :data-lucide="expandedEpics.includes(epic.id) ? 'chevron-down' : 'chevron-right'"
                                           class="w-3 h-3 text-muted-foreground flex-shrink-0 opacity-60 group-hover/epic:opacity-100 transition-opacity"></i>
                                        <i :data-lucide="getEpicStatusIcon(epic.status)" :class="getStatusTextColor(epic.status)" class="w-3 h-3 flex-shrink-0 opacity-60 group-hover/epic:opacity-100 transition-opacity"></i>
                                        <span class="font-medium tabular-nums" x-text="'Epic ' + epic.id"></span>
                                        <span x-text="epic.title" class="truncate flex-1 text-muted-foreground"></span>
                                        <span class="badge-secondary text-xs" x-text="getEpicProgress(epic).split(' ')[0]"></span>
                                        <button class="opacity-0 group-hover/epic:opacity-100 p-0.5 hover:bg-muted rounded"
                                                data-testid="kebab-button"
                                                @click.stop="showContextMenu($event, 'epic', epic, null, null, 'kebab')">
                                            <i data-lucide="more-vertical" class="w-3 h-3"></i>
                                        </button>
                                    </div>

                                    <!-- Stories -->
                                    <div x-show="expandedEpics.includes(epic.id)" x-transition class="ml-4">
                                        <template x-for="story in epic.stories" :key="story.id">
                                            <div class="group/story">
                                                <div class="flex items-center gap-1.5 px-2 py-0.5 cursor-pointer hover:bg-white/10 rounded-sm transition-colors"
                                                     data-testid="story-node"
                                                     :data-status="story.status"
                                                     :class="{'bg-primary/10 ring-1 ring-primary/50': selectedItem.type === 'story' && selectedItem.story?.id === story.id && selectedItem.epic?.id === epic.id}"
                                                     @click="selectItem('story', epic, story); toggleStory(`${epic.id}-${story.id}`)"
                                                     @contextmenu.prevent="showContextMenu($event, 'story', story, epic)">
                                                    <i :data-lucide="expandedStories.includes(`${epic.id}-${story.id}`) ? 'chevron-down' : 'chevron-right'"
                                                       class="w-3 h-3 text-muted-foreground flex-shrink-0 opacity-60 group-hover/story:opacity-100 transition-opacity"></i>
                                                    <i :data-lucide="getStatusIcon(story.status)" :class="getStatusTextColor(story.status)" class="w-3 h-3 flex-shrink-0 opacity-60 group-hover/story:opacity-100 transition-opacity"></i>
                                                    <span x-text="`${epic.id}.${story.id}`" class="tabular-nums text-muted-foreground w-6"></span>
                                                    <span x-text="story.title" class="truncate flex-1"></span>
                                                    <button class="opacity-0 group-hover/story:opacity-100 p-0.5 hover:bg-muted rounded"
                                                            data-testid="kebab-button"
                                                            @click.stop="showContextMenu($event, 'story', story, epic, null, 'kebab')">
                                                        <i data-lucide="more-vertical" class="w-3 h-3"></i>
                                                    </button>
                                                </div>

                                                <!-- Phases -->
                                                <div x-show="expandedStories.includes(`${epic.id}-${story.id}`)" x-transition class="ml-7 text-xs">
                                                    <template x-for="phase in story.phases" :key="phase.name">
                                                        <div class="group/phase flex items-center gap-1.5 px-2 py-0.5 cursor-pointer hover:bg-white/10 rounded-sm transition-colors"
                                                             data-testid="phase-node"
                                                             :data-phase="phase.name"
                                                             :class="{'bg-primary/10 ring-1 ring-primary/50': selectedItem.type === 'phase' && selectedItem.phase?.name === phase.name && selectedItem.story?.id === story.id && selectedItem.epic?.id === epic.id}"
                                                             @click="selectItem('phase', epic, story, phase)"
                                                             @contextmenu.prevent="showContextMenu($event, 'phase', phase, epic, story)">
                                                            <i :data-lucide="getPhaseIcon(phase.status)" :class="getPhaseTextColor(phase.status)" class="w-3 h-3 opacity-60 group-hover/phase:opacity-100 transition-opacity"></i>
                                                            <span x-text="phase.name" class="text-muted-foreground"></span>
                                                            <button class="opacity-0 group-hover/phase:opacity-100 p-0.5 hover:bg-muted rounded ml-auto"
                                                                    data-testid="kebab-button"
                                                                    @click.stop="showContextMenu($event, 'phase', phase, epic, story, 'kebab')">
                                                                <i data-lucide="more-vertical" class="w-3 h-3"></i>
                                                            </button>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                        <!-- Loading Skeleton (Story 16.5) -->
                        <div x-show="loading" class="p-4 space-y-3">
                            <div class="animate-pulse flex items-center gap-2">
                                <div class="w-3 h-3 bg-border rounded"></div>
                                <div class="h-4 bg-border rounded w-3/4"></div>
                            </div>
                            <div class="animate-pulse flex items-center gap-2">
                                <div class="w-3 h-3 bg-border rounded"></div>
                                <div class="h-4 bg-border rounded w-2/3"></div>
                            </div>
                            <div class="animate-pulse flex items-center gap-2">
                                <div class="w-3 h-3 bg-border rounded"></div>
                                <div class="h-4 bg-border rounded w-1/2"></div>
                            </div>
                        </div>
                        <!-- Error State (Story 16.5) -->
                        <div x-show="loadError && !loading" class="text-destructive text-sm p-4 flex items-center gap-2">
                            <i data-lucide="alert-circle" class="w-4 h-4"></i>
                            <span x-text="loadError"></span>
                        </div>
                        <!-- Empty State -->
                        <div x-show="!loading && !loadError && !stories.epics" class="text-muted-foreground text-sm p-4">
                            No stories found
                        </div>
                    </div>
            </nav>

            <!-- Detail Panel (Story 16.5) -->
            <div x-show="selectedItem.type" x-transition class="p-4 border-t border-border bg-card/50">
                <!-- Epic Details -->
                <template x-if="selectedItem.type === 'epic'">
                    <div>
                        <h3 class="font-semibold text-foreground">Epic <span x-text="selectedItem.epic?.id" class="tabular-nums"></span></h3>
                        <p x-text="selectedItem.epic?.title" class="text-sm text-muted-foreground truncate"></p>
                        <div class="mt-2 flex items-center gap-2">
                            <i :data-lucide="getEpicStatusIcon(selectedItem.epic?.status)" :class="getStatusTextColor(selectedItem.epic?.status)" class="w-4 h-4"></i>
                            <span x-text="selectedItem.epic?.status" class="text-xs text-muted-foreground"></span>
                        </div>
                        <div class="mt-1 text-xs text-muted-foreground">
                            Progress: <span x-text="getEpicProgress(selectedItem.epic)"></span>
                        </div>
                    </div>
                </template>
                <!-- Story Details -->
                <template x-if="selectedItem.type === 'story'">
                    <div>
                        <h3 class="font-semibold text-foreground tabular-nums">
                            <span x-text="`${selectedItem.epic?.id}.${selectedItem.story?.id}`"></span>
                        </h3>
                        <p x-text="selectedItem.story?.title" class="text-sm text-muted-foreground truncate"></p>
                        <div class="mt-2 flex items-center gap-2">
                            <i :data-lucide="getStatusIcon(selectedItem.story?.status)" :class="getStatusTextColor(selectedItem.story?.status)" class="w-4 h-4"></i>
                            <span x-text="selectedItem.story?.status" class="text-xs text-muted-foreground"></span>
                        </div>
                        <div class="mt-1 text-xs text-muted-foreground">
                            Phases: <span x-text="selectedItem.story?.phases?.length || 0"></span>
                        </div>
                    </div>
                </template>
                <!-- Phase Details -->
                <template x-if="selectedItem.type === 'phase'">
                    <div>
                        <h3 class="font-semibold text-foreground" x-text="selectedItem.phase?.name"></h3>
                        <div class="mt-2 flex items-center gap-2">
                            <i :data-lucide="getPhaseIcon(selectedItem.phase?.status)" :class="getPhaseTextColor(selectedItem.phase?.status)" class="w-4 h-4"></i>
                            <span x-text="selectedItem.phase?.status" class="text-xs text-muted-foreground"></span>
                        </div>
                        <div class="mt-1 text-xs text-muted-foreground">
                            Story: <span x-text="`${selectedItem.epic?.id}.${selectedItem.story?.id}`" class="tabular-nums"></span>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Status Bar -->
            <footer class="p-4 border-t border-border text-xs text-muted-foreground">
                <div x-show="queue.current">
                    Current: <span x-text="queue.current?.workflow" class="text-primary"></span>
                    <span x-text="`${queue.current?.epic_num}.${queue.current?.story_num}`" class="tabular-nums"></span>
                </div>
                <div x-show="queue.queue?.length">
                    Queue: <span x-text="queue.queue?.length"></span> pending
                </div>
            </footer>

            <!-- Resize Handle -->
            <div class="absolute top-0 right-0 w-1 h-full cursor-col-resize bg-transparent hover:bg-primary/50 transition-colors"
                 @mousedown.prevent="
                     const startX = $event.clientX;
                     const startWidth = sidebarWidth;
                     const onMove = (e) => {
                         const newWidth = startWidth + (e.clientX - startX);
                         sidebarWidth = Math.min(400, Math.max(200, newWidth));
                     };
                     const onUp = () => {
                         document.removeEventListener('mousemove', onMove);
                         document.removeEventListener('mouseup', onUp);
                     };
                     document.addEventListener('mousemove', onMove);
                     document.addEventListener('mouseup', onUp);
                 "></div>
        </aside>
