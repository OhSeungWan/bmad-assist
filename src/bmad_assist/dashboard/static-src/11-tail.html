
            <!-- Content -->
            <div class="flex-1 overflow-auto p-4">
                <pre class="text-sm whitespace-pre-wrap font-mono"><code x-text="contentModal.content"></code></pre>
            </div>
        </div>
    </div>

    <!-- Report List Modal (Story 16.9 - AC 4) -->
    <div x-show="reportModal.show"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @keydown.escape.window="if (reportModal.show && !contentModal.show && !busyModal.show) reportModal.show = false"
         class="fixed inset-0 z-40 flex items-center justify-center bg-black/50"
         data-testid="report-modal">

        <div class="card shadow-xl w-96 max-h-[60vh] flex flex-col"
             x-show="reportModal.show"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             role="dialog"
             aria-modal="true"
             @click.outside="reportModal.show = false">

            <!-- Header -->
            <div class="px-4 py-3 border-b border-border">
                <h2 class="text-lg font-semibold flex items-center gap-2">
                    <i data-lucide="file-text" class="w-5 h-5"></i>
                    Validation Reports
                    <span class="text-muted-foreground text-sm" x-text="`${reportModal.epic}.${reportModal.story}`"></span>
                </h2>
            </div>

            <!-- Report List -->
            <div class="flex-1 overflow-auto p-2">
                <!-- Synthesis (highlighted) -->
                <template x-if="reportModal.synthesis">
                    <button @click="loadReportContent(reportModal.synthesis)"
                            class="w-full text-left px-3 py-2 rounded bg-primary/10 hover:bg-primary/20 mb-2 focus:ring-2 focus:ring-ring focus:outline-none flex items-center gap-2"
                            data-testid="synthesis-report">
                        <i data-lucide="edit" class="w-4 h-4 text-primary"></i>
                        <span class="text-primary font-medium">Synthesis Report</span>
                    </button>
                </template>

                <!-- Individual Reports -->
                <template x-for="report in reportModal.reports" :key="report.path">
                    <button @click="loadReportContent(report)"
                            class="w-full text-left px-3 py-2 rounded hover:bg-secondary mb-1 focus:ring-2 focus:ring-ring focus:outline-none flex items-center gap-2"
                            data-testid="report-item">
                        <i data-lucide="file" class="w-4 h-4"></i>
                        <span x-text="report.provider || report.name"></span>
                    </button>
                </template>

                <!-- Empty State -->
                <div x-show="reportModal.reports.length === 0 && !reportModal.synthesis"
                     class="text-muted-foreground text-center py-4"
                     data-testid="empty-reports">
                    No validation reports found for <span x-text="`${reportModal.epic}.${reportModal.story}`"></span>
                </div>
            </div>

            <!-- Footer -->
            <div class="px-4 py-3 border-t border-border">
                <button @click="reportModal.show = false"
                        class="btn-outline w-full"
                        data-testid="close-report-modal">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Import Preview Modal (Story 17.12 AC6) -->
    <div x-show="importView.modalOpen"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         @keydown.escape.window="if (importView.modalOpen && !busyModal.show) closeImportModal()"
         class="fixed inset-0 z-50 flex items-center justify-center bg-black/50"
         data-testid="import-modal">

        <div class="card shadow-xl w-[600px] max-h-[80vh] flex flex-col"
             x-show="importView.modalOpen"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100">

            <!-- Header -->
            <div class="flex items-center justify-between px-4 py-3 border-b border-border">
                <h2 class="text-lg font-semibold flex items-center gap-2">
                    <i data-lucide="file-up" class="w-5 h-5"></i>
                    Import Preview
                    <span class="text-muted-foreground text-sm" x-text="importView.filename"></span>
                </h2>
                <button @click="closeImportModal()"
                        class="btn-sm-icon-ghost">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>

            <!-- Scope Selector (disabled while loading) -->
            <div class="px-4 py-3 border-b border-border flex items-center gap-4">
                <span class="text-sm text-muted-foreground">Import to:</span>
                <label class="flex items-center gap-2 cursor-pointer" :class="{'opacity-50': importView.loading}">
                    <input type="radio" value="global" x-model="importView.scope"
                           :disabled="importView.loading"
                           @change="refreshImportPreview()"
                           class="form-radio text-primary">
                    <span>Global</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer" :class="{'opacity-50': importView.loading}">
                    <input type="radio" value="project" x-model="importView.scope"
                           :disabled="importView.loading"
                           @change="refreshImportPreview()"
                           class="form-radio text-primary">
                    <span>Project</span>
                </label>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-auto p-4 space-y-4">

                <!-- Loading -->
                <div x-show="importView.loading" class="flex items-center justify-center py-8">
                    <i data-lucide="loader-2" class="w-6 h-6 animate-spin text-primary"></i>
                    <span class="ml-2">Validating import...</span>
                </div>

                <!-- Errors -->
                <div x-show="importView.errors && !importView.loading"
                     class="bg-destructive/10 border border-destructive/30 rounded p-4">
                    <div class="flex items-center gap-2 text-destructive mb-2">
                        <i data-lucide="alert-circle" class="w-5 h-5"></i>
                        <span class="font-medium">Import Validation Failed</span>
                    </div>
                    <div x-show="importView.errors === 'validation'" class="space-y-2">
                        <template x-for="(msg, path) in validationErrors" :key="path">
                            <div class="text-sm">
                                <span class="font-mono text-xs" x-text="path"></span>:
                                <span class="text-destructive" x-text="msg"></span>
                            </div>
                        </template>
                    </div>
                    <div x-show="typeof importView.errors === 'string'" class="text-sm" x-text="importView.errors"></div>
                </div>

                <!-- Diff Preview -->
                <div x-show="importView.diff && !importView.loading && !importView.errors" class="space-y-4">

                    <!-- No Changes -->
                    <div x-show="!hasImportChanges()"
                         class="text-center py-8 text-muted-foreground">
                        <i data-lucide="check-circle" class="w-8 h-8 mx-auto mb-2 text-accent"></i>
                        <p>No changes detected.</p>
                        <p class="text-sm">Import matches current <span x-text="importView.scope"></span> config.</p>
                    </div>

                    <!-- Added Fields -->
                    <div x-show="Object.keys(importView.diff?.added || {}).length > 0">
                        <h4 class="text-sm font-medium text-accent mb-2 flex items-center gap-2">
                            <i data-lucide="plus-circle" class="w-4 h-4"></i>
                            Added (<span x-text="Object.keys(importView.diff?.added || {}).length"></span>)
                        </h4>
                        <div class="space-y-1">
                            <template x-for="(value, path) in importView.diff?.added || {}" :key="path">
                                <div class="flex items-center gap-2 px-3 py-2 bg-accent/10 rounded text-sm">
                                    <span class="font-mono text-xs flex-1" x-text="path"></span>
                                    <span class="text-accent truncate max-w-[200px]" x-text="JSON.stringify(value)"></span>
                                    <i x-show="importView.riskyFields?.includes(path)"
                                       data-lucide="alert-triangle" class="w-4 h-4 text-bp-warning" title="Risky field"></i>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Modified Fields -->
                    <div x-show="Object.keys(importView.diff?.modified || {}).length > 0">
                        <h4 class="text-sm font-medium text-bp-warning mb-2 flex items-center gap-2">
                            <i data-lucide="edit" class="w-4 h-4"></i>
                            Modified (<span x-text="Object.keys(importView.diff?.modified || {}).length"></span>)
                        </h4>
                        <div class="space-y-1">
                            <template x-for="(change, path) in importView.diff?.modified || {}" :key="path">
                                <div class="flex items-center gap-2 px-3 py-2 bg-bp-warning/10 rounded text-sm">
                                    <span class="font-mono text-xs" x-text="path"></span>
                                    <span class="text-muted-foreground line-through truncate max-w-[100px]" x-text="JSON.stringify(change.old)"></span>
                                    <i data-lucide="arrow-right" class="w-3 h-3"></i>
                                    <span class="text-bp-warning truncate max-w-[100px]" x-text="JSON.stringify(change.new)"></span>
                                    <i x-show="importView.riskyFields?.includes(path)"
                                       data-lucide="alert-triangle" class="w-4 h-4 text-bp-warning ml-auto" title="Risky field"></i>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Removed Fields -->
                    <div x-show="(importView.diff?.removed || []).length > 0">
                        <h4 class="text-sm font-medium text-destructive mb-2 flex items-center gap-2">
                            <i data-lucide="minus-circle" class="w-4 h-4"></i>
                            Removed (<span x-text="(importView.diff?.removed || []).length"></span>)
                        </h4>
                        <div class="space-y-1">
                            <template x-for="path in importView.diff?.removed || []" :key="path">
                                <div class="flex items-center gap-2 px-3 py-2 bg-destructive/10 rounded text-sm">
                                    <span class="font-mono text-xs text-destructive" x-text="path"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="flex justify-end gap-3 px-4 py-3 border-t border-border">
                <button class="btn-outline" @click="closeImportModal()">
                    Cancel
                </button>
                <button class="btn"
                        :disabled="importView.loading || importView.errors || !importView.diff || !hasImportChanges()"
                        @click="applyImport()">
                    <template x-if="importView.loading">
                        <i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>
                    </template>
                    Apply Import
                </button>
            </div>
        </div>
    </div>

    <!-- Run Trigger Modal (Story 19.6) -->
    <div x-show="runTrigger.modalOpen"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @keydown.escape.window="if (runTrigger.modalOpen) closeRunTriggerModal()"
         class="fixed inset-0 z-50 flex items-center justify-center bg-black/50"
         data-testid="run-trigger-modal">

        <div class="card shadow-xl w-full max-w-md"
             x-show="runTrigger.modalOpen"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             @click.outside="closeRunTriggerModal()">

            <!-- Header -->
            <div class="flex items-center justify-between px-4 py-3 border-b border-border">
                <h2 class="text-lg font-semibold flex items-center gap-2">
                    <i data-lucide="play-circle" class="w-5 h-5"></i>
                    Start Experiment Run
                </h2>
                <button @click="closeRunTriggerModal()" class="btn-sm-icon-ghost">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>

            <!-- Form -->
            <div class="p-4 space-y-4">
                <!-- Error -->
                <div x-show="runTrigger.error"
                     class="bg-destructive/10 border border-destructive/30 rounded p-3 text-sm text-destructive">
                    <i data-lucide="alert-circle" class="w-4 h-4 inline-block mr-1"></i>
                    <span x-text="runTrigger.error"></span>
                </div>

                <!-- Fixture -->
                <div>
                    <label class="block text-sm font-medium mb-1">Fixture</label>
                    <select x-model="runTrigger.fixture"
                            class="input w-full"
                            data-testid="run-trigger-fixture">
                        <template x-for="f in runTrigger.fixtures" :key="f.name">
                            <option :value="f.name" x-text="f.name"></option>
                        </template>
                    </select>
                    <p x-show="runTrigger.fixtures.length === 0" class="text-sm text-muted-foreground mt-1">
                        No fixtures found
                    </p>
                </div>

                <!-- Config -->
                <div>
                    <label class="block text-sm font-medium mb-1">Config</label>
                    <select x-model="runTrigger.config"
                            class="input w-full"
                            data-testid="run-trigger-config">
                        <template x-for="c in runTrigger.configs" :key="c.name">
                            <option :value="c.name" x-text="c.name"></option>
                        </template>
                    </select>
                    <p x-show="runTrigger.configs.length === 0" class="text-sm text-muted-foreground mt-1">
                        No configs found
                    </p>
                </div>

                <!-- Patch-Set -->
                <div>
                    <label class="block text-sm font-medium mb-1">Patch-Set</label>
                    <select x-model="runTrigger.patchSet"
                            class="input w-full"
                            data-testid="run-trigger-patchset">
                        <template x-for="p in runTrigger.patchSets" :key="p.name">
                            <option :value="p.name" x-text="p.name"></option>
                        </template>
                    </select>
                    <p x-show="runTrigger.patchSets.length === 0" class="text-sm text-muted-foreground mt-1">
                        No patch-sets found
                    </p>
                </div>

                <!-- Loop -->
                <div>
                    <label class="block text-sm font-medium mb-1">Loop</label>
                    <select x-model="runTrigger.loop"
                            class="input w-full"
                            data-testid="run-trigger-loop">
                        <template x-for="l in runTrigger.loops" :key="l.name">
                            <option :value="l.name" x-text="l.name"></option>
                        </template>
                    </select>
                    <p x-show="runTrigger.loops.length === 0" class="text-sm text-muted-foreground mt-1">
                        No loops found
                    </p>
                </div>
            </div>

            <!-- Footer -->
            <div class="flex justify-end gap-3 px-4 py-3 border-t border-border">
                <button class="btn-outline" @click="closeRunTriggerModal()">
                    Cancel
                </button>
                <button class="btn"
                        :disabled="runTrigger.loading || !runTrigger.fixture || !runTrigger.config || !runTrigger.patchSet || !runTrigger.loop"
                        @click="submitRunTrigger()"
                        data-testid="run-trigger-submit">
                    <template x-if="runTrigger.loading">
                        <i data-lucide="loader-2" class="w-4 h-4 animate-spin mr-1"></i>
                    </template>
                    <i x-show="!runTrigger.loading" data-lucide="play" class="w-4 h-4 mr-1"></i>
                    Start Run
                </button>
            </div>
        </div>
    </div>

    <!-- Active Experiment Progress (Story 19.6) - Fixed position floating card -->
    <div x-show="activeExperiment.runId"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-4"
         x-transition:enter-end="opacity-100 translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 translate-y-0"
         x-transition:leave-end="opacity-0 translate-y-4"
         class="fixed bottom-4 right-4 z-40 w-80"
         data-testid="active-experiment-progress">

        <div class="card shadow-xl border border-border">
            <!-- Header -->
            <div class="flex items-center justify-between px-3 py-2 border-b border-border bg-card">
                <div class="flex items-center gap-2">
                    <i data-lucide="flask-conical" class="w-4 h-4 text-primary"></i>
                    <span class="text-sm font-medium truncate max-w-[140px]" x-text="activeExperiment.runId"></span>
                </div>
                <div class="flex items-center gap-1">
                    <span :class="getExperimentStatusClass()" class="px-2 py-0.5 text-xs rounded-full"
                          x-text="activeExperiment.status"></span>
                    <button @click="clearActiveExperiment()"
                            class="btn-sm-icon-ghost"
                            title="Dismiss">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </button>
                </div>
            </div>

            <!-- Progress -->
            <div class="px-3 py-3 space-y-2">
                <!-- Progress Bar -->
                <div class="w-full bg-muted rounded-full h-2 overflow-hidden">
                    <div class="bg-primary h-2 rounded-full transition-all duration-300"
                         :style="`width: ${activeExperiment.percent}%`"></div>
                </div>

                <!-- Stats -->
                <div class="flex items-center justify-between text-xs text-muted-foreground">
                    <span>
                        <span x-text="activeExperiment.storiesCompleted"></span>/<span x-text="activeExperiment.storiesTotal"></span> stories
                    </span>
                    <span x-text="`${activeExperiment.percent}%`"></span>
                </div>

                <!-- Current Phase/Story -->
                <div x-show="activeExperiment.phase || activeExperiment.story" class="text-xs text-muted-foreground truncate">
                    <span x-show="activeExperiment.phase" x-text="activeExperiment.phase"></span>
                    <span x-show="activeExperiment.story">
                        - <span x-text="activeExperiment.story"></span>
                    </span>
                </div>

                <!-- Cancel Button -->
                <button x-show="hasActiveExperiment()"
                        @click="cancelExperiment()"
                        class="btn-outline btn-destructive w-full text-sm"
                        data-testid="cancel-experiment-btn">
                    <i data-lucide="square" class="w-3 h-3 mr-1"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script src="/js/alpine-init.js"></script>
</body>
</html>
